<?xml version="1.0" encoding="UTF-8"?>
<fmiModelDescription
  fmiVersion="2.0"
  modelName="{{ model_name }}"
  description="{{ model_description }}"
  generationTool="ONNX2FMU"
  guid="{{ model_GUID }}"
  numberOfEventIndicators="0">

  <CoSimulation
    modelIdentifier="{{ model_name }}"
    canHandleVariableCommunicationStepSize="{{ canHandleVariableCommunicationStepSize }}"
    canNotUseMemoryManagementFunctions="{{ canNotUseMemoryManagementFunctions }}"
    canGetAndSetFMUstate="{{ canGetAndSetFMUstate }}"
    canSerializeFMUstate="{{ canSerializeFMUstate }}">
    <SourceFiles>
      <File name="all.c"/>
    </SourceFiles>
  </CoSimulation>

  <LogCategories>
    <Category name="logEvents" description="Log events"/>
    <Category name="logStatusError" description="Log error messages"/>
  </LogCategories>

  <DefaultExperiment startTime="{{ startTime }}" stopTime="{{ stopTime }}"/>

  <ModelVariables>
    <ScalarVariable name="time" valueReference="0" causality="independent" variability="continuous" description="Simulation time">
      <Real/>
    </ScalarVariable>
    {%- for input in input_entries %}
    {%- for i, idx in input.indexes.items() %}
    <ScalarVariable name="{{ input.name }}_{{ idx|join('_')}}" valueReference="{{ i }}" causality="{{ input.causality }}" variability="{{ input.variability }}" description="{{ input.input_names[loop.index0] }}">
      <Real start="2.0"/>
    </ScalarVariable>
    {%- endfor %}
    {%- endfor %}
    {%- for output in output_entries %}
    {%- for i, idx in output.indexes.items() %}
    <ScalarVariable name="{{ output.name }}_{{ idx|join('_')}}" valueReference="{{ i }}" causality="{{ output.causality }}" variability="{{ output.variability }}" description="{{ output.output_names[loop.index0] }}">
      <Real/>
    </ScalarVariable>
    {%- endfor %}
    {%- endfor %}
  </ModelVariables>

  <ModelStructure>
    <Outputs>
    {%- for output in output_entries %}
    {%- for k in output.indexes.keys() %}
      <Unknown index="{{ k + 1 }}"/>
    {%- endfor %}
    {%- endfor %}
    </Outputs>
    <InitialUnknowns>
    {%- for output in output_entries %}
    {%- for k in output.indexes.keys() %}
      <Unknown index="{{ k + 1 }}"/>
    {%- endfor %}
    {%- endfor %}
    </InitialUnknowns>
  </ModelStructure>

</fmiModelDescription>
